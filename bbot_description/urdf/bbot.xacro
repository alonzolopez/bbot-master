<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro">
    <!-- Import all Gazebo customization elements including colors-->
    <xacro:include filename="$(find bbot_description)/urdf/bbot.gazebo.xacro"/>
    <!-- Import transmissions -->

    <!-- Include Utilities -->

    <!--Define properties-->
    <xacro:property name="safety_controller_k_pos" value="100" />
    <xacro:property name="safety_controller_k_vel" value="2" /> 
    <xacro:property name="joint_damping" value="0.5" />
    <xacro:property name="max_effort" value="300"/>
    <xacro:property name="max_velocity" value="10"/>


    <xacro:macro name="bbot" params="parent robot_name *origin">
        <!-- joint between parent (a.k.a. world) and link_0 -->
        <joint name="${parent}_${robot_name}_joint" type="fixed">
            <xacro:insert_block name="origin"/>
            <parent link="${parent}"/>
            <child link="${robot_name}_link_baseplate"/>
        </joint>

        <link name="${robot_name}_link_baseplate">
            <inertial>
                <origin xyz="0 0 0" rpy="${pi/2.0} 0 0"/>
                <mass value="1"/>
                <inertia ixx="1.0" ixy="0" ixz="0" iyy="1" iyz="0" izz="1"/>
            </inertial>

            <visual>
                <origin xyz="-0.0502 0.0508 0" rpy="${pi/2.0} 0 0"/>
                <geometry>
                    <mesh filename="package://bbot_description/meshes/baseplate.stl" scale="0.001 0.001 0.001"/>
                </geometry>
                <material name="Orange"/>
            </visual>

            <collision>
                <origin xyz="-0.0502 0.0508 0" rpy="${pi/2.0} 0 0"/>
                <geometry>
                    <mesh filename="package://bbot_description/meshes/baseplate.stl" scale="0.001 0.001 0.001"/>
                </geometry>
                <material name="Orange"/>
            </collision>
        </link>

        <joint name="${robot_name}_base_motor1" type="fixed">
            <parent link="${robot_name}_link_baseplate"/>
            <child link="${robot_name}_link_motor1"/>
            <origin xyz="0 0 0.00719" rpy="0 0 0"/>
        </joint>

        <link name="${robot_name}_link_motor1">
            <inertial>
                <origin xyz="0.0386 -0.0178 0" rpy="0 0 ${pi/2.0}"/>
                <mass value="1"/>
                <inertia ixx="1.0" ixy="0" ixz="0" iyy="1" iyz="0" izz="1"/>
            </inertial>

            <visual>
                <origin xyz="0.0386 -0.0178 0.00083" rpy="0 0 ${pi/2.0}"/>
                <geometry>
                    <mesh filename="package://bbot_description/meshes/motor.stl" scale="0.001 0.001 0.001"/>
                </geometry>
                <material name="Black"/>
            </visual>

            <collision>
                <origin xyz="0.0386 -0.0178 0.00083" rpy="0 0 ${pi/2.0}"/>
                <geometry>
                    <mesh filename="package://bbot_description/meshes/motor.stl" scale="0.001 0.001 0.001"/>
                </geometry>
                <material name="Black"/>
            </collision>
        </link>

        <joint name="${robot_name}_motor1_motor2_joint" type="revolute">
            <parent link="${robot_name}_link_motor1"/>
            <child link="${robot_name}_link_motor2"/>
            <origin xyz="0 0 0.0517" rpy="0 0 0"/>
            <axis xyz="0 0 1"/>
            <limit lower="${-170 * pi / 180}" upper="${170 * pi / 180}"
                effort="${max_effort}" velocity="${max_velocity}" />
            <safety_controller soft_lower_limit="${-168 * pi / 180}"
                     soft_upper_limit="${168 * pi / 180}"
                     k_position="${safety_controller_k_pos}"
                     k_velocity="${safety_controller_k_vel}"/> 
            <dynamics damping="${joint_damping}"/>
        </joint>

        <link name="${robot_name}_link_motor2">
            <inertial>
                <origin xyz="-0.0178 0.015 0" rpy="${pi/2.0} 0 0"/>
                <mass value="1"/>
                <inertia ixx="1.0" ixy="0" ixz="0" iyy="1" iyz="0" izz="1"/>
            </inertial>

            <visual>
                <origin xyz="-0.0178 0.015 0" rpy="${pi/2.0} 0 0"/>
                <geometry>
                    <mesh filename="package://bbot_description/meshes/motor.stl" scale="0.001 0.001 0.001"/>
                </geometry>
                <material name="Black"/>
            </visual>

            <collision>
                <origin xyz="-0.0178 0.015 0" rpy="${pi/2.0} 0 0"/>
                <geometry>
                    <mesh filename="package://bbot_description/meshes/motor.stl" scale="0.001 0.001 0.001"/>
                </geometry>
                <material name="Black"/>
            </collision>
        </link>
        <xacro:bbot_gazebo robot_name="${robot_name}"/>
    </xacro:macro>

</robot>